<!DOCTYPE html>
<html>
<head>
    <title>Sistema de Chamada - Yodeck</title>
    <style>
        /* Design limpo para as TVs da empresa */
        body { margin: 0; background: #085c00; color: white; font-family: Arial, sans-serif; display: flex; align-items: center; justify-content: center; height: 100vh; overflow: hidden; }
        .painel { text-align: center; }
        .nome { font-size: 10vw; text-transform: uppercase; color: #ff0000; margin: 20px 0; }
        .setor-label { font-size: 3vw; opacity: 0.7; }
        .admin-box { position: fixed; bottom: 10px; left: 10px; background: rgba(0,0,0,0.5); padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>

    <div class="painel" id="display">
        <div class="setor-label" id="labelSetor">AGUARDANDO...</div>
        <div class="nome" id="nomeCliente">---</div>
    </div>

    <div class="admin-box" id="adminPanel">
        <input type="text" id="inputNome" placeholder="Nome do Cliente">
        <button onclick="enviarChamada()">CHAMAR</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDJMLtWc4LqcRXXJyvt5e0h9iJbJ1MmI9k",
            authDomain: "painel-yodeck-empresa.firebaseapp.com",
            databaseURL: "https://painel-yodeck-empresa-default-rtdb.firebaseio.com",
            projectId: "painel-yodeck-empresa",
            storageBucket: "painel-yodeck-empresa.firebasestorage.app",
            messagingSenderId: "542981867246",
            appId: "1:542981867246:web:a5390d90ac06764b7495ff",
            measurementId: "G-TPBSM0ZTBH"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const params = new URLSearchParams(window.location.search);
        const meuSetor = params.get('setor') || 'recepcao';
        const modoTV = params.has('tv');

        document.getElementById('labelSetor').innerText = "SETOR: " + meuSetor.toUpperCase();
        if (modoTV) { document.getElementById('adminPanel').style.display = 'none'; }

        // Função para a TV "falar" o nome
        const falarNome = (nome) => {
            const msg = new SpeechSynthesisUtterance();
            msg.text = `Atenção, cliente ${nome}, comparecer ao setor ${meuSetor}`;
            msg.lang = 'pt-BR';
            window.speechSynthesis.speak(msg);
        };

        let ultimoNome = "";

        onValue(ref(db, 'chamadas/' + meuSetor), (snapshot) => {
            const data = snapshot.val();
            if (data && data.nome && data.nome !== ultimoNome) {
                document.getElementById('nomeCliente').innerText = data.nome;
                ultimoNome = data.nome;
                
                if (modoTV) {
                    falarNome(data.nome);
                    // Limpa a tela após 1 minuto (60000ms)
                    setTimeout(() => {
                        document.getElementById('nomeCliente').innerText = "---";
                        ultimoNome = "";
                    }, 60000);
                }
            }
        });

        window.enviarChamada = function() {
            const nomeInput = document.getElementById('inputNome');
            if(nomeInput.value.trim() !== "") {
                set(ref(db, 'chamadas/' + meuSetor), { 
                    nome: nomeInput.value,
                    timestamp: Date.now() 
                });
                nomeInput.value = "";
            }
        }
    </script>